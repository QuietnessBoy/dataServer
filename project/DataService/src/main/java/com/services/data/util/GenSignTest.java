package com.services.data.util;

import com.alibaba.fastjson.JSONObject;
import com.services.data.config.HttpMethod;
import com.services.data.dto.JsonResult;
import org.apache.commons.codec.digest.DigestUtils;

import java.text.SimpleDateFormat;
import java.util.List;
import java.util.Map;

/**
 * @ProjectName yizhuangsmartcity
 * @Package com.services.data.util
 * @ClassName GenSign
 * @Description 生成签名串
 * @Company HaoBo
 * @Author wangw
 * @Date 2019/12/2 0002 14:48
 * @UpdateUser
 * @UpdateDate
 * @UpdateRemark
 * @Version 1.0.0
 */
public class GenSignTest {

    public static String appKey= "c56fc3ab3bb9100fef62bf4bca330adb669b5208";
    public static String appSecret= "bd2534f6b779738a2a7b40e886a74642ad8e8696";
    public static String interUrl = "/api/datashare/table/list";
    public static String tableUrl = "/api/datashare/table/get";
    public static String dataUrl = "/api/datashare/data";
    public static String method = "GET";
    public static String ip = "10.117.5.223:86";
    public static String name = "/etown-bigdata-datashare";
    public static long nowTimeStamp = System.currentTimeMillis();

    /** 
     * @Title 生成签名字符串
     * @Description 通过appkey/appSecret/url/method/timeStamp进行md5加密得到sign
     * @return  
     * @author wangw
     * @date  
    */
    public static String gen(){
        SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
        String signMsg = method+name+interUrl+appSecret+nowTimeStamp;
        System.out.println("############"+signMsg);
        String sign = DigestUtils.md5Hex(signMsg);
        return sign;
    }

    public static String genTableSign(){
        SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
        String signMsg = method+name+tableUrl+appSecret+nowTimeStamp;
        System.out.println("############"+signMsg);
        String sign = DigestUtils.md5Hex(signMsg);
        return sign;
    }

    public static String genDataSign(){
        SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
        String signMsg = method+name+dataUrl+appSecret+nowTimeStamp;
        System.out.println("############"+signMsg);
        String sign = DigestUtils.md5Hex(signMsg);
        return sign;
    }
    /**
     * @Title
     * @Description 当获取到sign后,请求接口,获取数据
     * @return
     * @author wangw
     * @date
     */
    public static void request(){
        String sign = gen();
        String url = "http://"+ip+"/"+name+interUrl+"?appKey="+appKey+"&sign="+sign+"&timestamp="+nowTimeStamp;
        System.out.println(url);
        JsonResult jsonResult = HttpMethod.httpGETCase(url);
        System.out.println(jsonResult);
    }


    /**
     * @Title
     * @Description 当获取到sign后,请求接口,获取数据
     * @return
     * @author wangw
     * @date
     */
    public static void requestTable(){
        String sign = genTableSign();
//        String url = "http://"+ip+"/"+name+tableUrl+"?appKey="+appKey+"&sign="+sign+"&timestamp="+nowTimeStamp+"&tableId=32033be2c26111e9b84a7cd30a5dd860";
        String url = "http://"+ip+"/"+name+0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +"?appKey="+appKey+"&sign="+sign+"&timestamp="+nowTimeStamp+"&tableId=32033be2c26111e9b84a7cd30a5dd860";
        JsonResult jsonResult = HttpMethod.httpGETCase(url);
        System.out.println(url);
        System.out.println(jsonResult);
    }
    /**
     * 获取的法人信息
     */
    public static JsonResult requestData(){
        String sign = genDataSign();
//        String url = "http://"+ip+"/"+name+dataUrl+"?appKey="+appKey+"&sign="+sign+"&timestamp="+nowTimeStamp+"&tableId=32033be2c26111e9b84a7cd30a5dd860&pageNum=1&pageSize=100";
        String url = "http://"+ip+"/"+name+dataUrl+"?appKey="+appKey+"&sign="+sign+"&timestamp="+nowTimeStamp+"&tableId=1fc22963e10511e9b84a7cd30a5dd860&pageNum=1&pageSize=100";
        System.out.println(url);
        JsonResult httpJsonResult = HttpMethod.httpGETCase(url);
        Object o = JSONObject.parse(httpJsonResult.getObj().toString());
        Map map = JSONObject.parseObject(JSONObject.toJSONString(o), Map.class);
        Object o1 = JSONObject.parse(map.get("body").toString());
        Map map1 = JSONObject.parseObject(JSONObject.toJSONString(o1), Map.class);
        List list = (List) map1.get("list");
        System.out.println(list);
        JsonResult jsonResult = new JsonResult();
        for (int i = 0; i < 2; i++) {
            JSONObject jsonObject1 = JSONObject.parseObject(list.get(i).toString());
        }
        return jsonResult;
    }

    public static void main(String[] args) {
        request();
        requestTable();
        requestData();
//        GenSign1 g = new GenSign1();
//        JsonResult jsonResult = g.requestData();
//        System.out.println(jsonResult);
    }
}